<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç —Å–µ—Ä–≤–µ—Ä–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <h3>üõ† –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É</h3>
    <div id="log" style="white-space: pre-wrap; font-family: monospace; background: #eee; padding: 10px;"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();

        const SERVER_URL = 'https://case-bot-server.onrender.com';
        const OWNER_ID = 7389462195;

        const log = document.getElementById('log');
        function addLog(msg) {
            log.innerHTML += msg + '\n';
        }

        addLog('üîç –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç...');

        const userId = tg.initDataUnsafe?.user?.id;
        if (!userId) {
            addLog('‚ùå –ù–µ—Ç userId ‚Äî —Ç—ã –æ—Ç–∫—Ä—ã–ª –Ω–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞!');
        } else {
            addLog(`‚úÖ –¢–≤–æ–π userId: ${userId}`);
        }

        // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞
        fetch(SERVER_URL)
            .then(res => res.text())
            .then(text => addLog(`‚úÖ –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω: ${text}`))
            .catch(e => addLog(`‚ùå –°–µ—Ä–≤–µ—Ä –ù–ï –¥–æ—Å—Ç—É–ø–µ–Ω: ${e}`));

        // 2. –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        fetch(`${SERVER_URL}/api/user`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                userId: Number(userId),
                username: tg.initDataUnsafe?.user?.username || 'test',
                firstName: tg.initDataUnsafe?.user?.first_name || ''
            })
        })
        .then(res => res.json())
        .then(data => addLog(`‚úÖ –û—Ç–≤–µ—Ç –æ—Ç /api/user: ${JSON.stringify(data)}`))
        .catch(e => addLog(`‚ùå –û—à–∏–±–∫–∞ /api/user: ${e}`));

        // 3. –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        fetch(`${SERVER_URL}/api/users`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ adminId: Number(OWNER_ID) })
        })
        .then(res => res.json())
        .then(data => addLog(`üë• –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: ${JSON.stringify(data)}`))
        .catch(e => addLog(`‚ùå –û—à–∏–±–∫–∞ /api/users: ${e}`));
    </script>
</body>
</html>