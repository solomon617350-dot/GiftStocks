<!DOCTYPE html>
<html>
<head>
    <title>üé∞ –ö–µ–π—Å—ã —Å –ø–æ–¥–∞—Ä–∫–∞–º–∏</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .top-bar {
            background: #0f0f0f;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(255,215,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid #2a2a2a;
        }
        
        .back-button {
            font-size: 18px;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 10px;
            background: #1a1a1a;
            display: none;
            font-weight: 500;
            color: #ffd700;
        }
        
        .back-button.visible {
            display: block;
        }
        
        .balance-container {
            display: flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(145deg, #1a1a1a, #2a2a2a);
            padding: 8px 20px;
            border-radius: 30px;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 4px 8px rgba(255,215,0,0.2);
            border: 1px solid #ffd700;
        }
        
        .balance-container:hover {
            transform: scale(1.05);
        }
        
        .star-icon {
            width: 30px;
            height: 30px;
            background: url('https://cdn1.tenchat.ru/static/vbc-gostinder/2025-09-21/5c565d16-168c-49e4-8b3c-6d20da018214.webp') center/contain no-repeat;
        }
        
        .balance-amount {
            color: #ffd700;
            font-size: 20px;
            font-weight: bold;
        }
        
        .content {
            flex: 1;
            padding: 20px;
            padding-bottom: 80px;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255,215,0,0.3);
        }
        
        .cases-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .case-card {
            background: #0f0f0f;
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(255,215,0,0.1);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 2px solid #2a2a2a;
        }
        
        .case-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(255,215,0,0.2);
            border-color: #ffd700;
        }
        
        .case-image {
            width: 100%;
            height: 150px;
            border-radius: 15px;
            margin-bottom: 10px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            background-color: transparent;
        }
        
        .bronze-case {
            background-image: url('https://i.postimg.cc/w3wd8bSR/image-2026-02-20-204059171.png');
        }
        
        .green-case {
            background-image: url('https://files.catbox.moe/sat3sc.jpg');
        }
        
        .case-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #fff;
            text-align: center;
        }
        
        .case-price {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            font-size: 16px;
            color: #ffd700;
            font-weight: bold;
        }
        
        .case-price .small-star {
            width: 18px;
            height: 18px;
            background: url('https://cdn1.tenchat.ru/static/vbc-gostinder/2025-09-21/5c565d16-168c-49e4-8b3c-6d20da018214.webp') center/contain no-repeat;
        }
        
        .case-detail {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .case-detail.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .detail-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .detail-image {
            width: 200px;
            height: 200px;
            border-radius: 30px;
            margin: 0 auto 20px;
            box-shadow: 0 10px 20px rgba(255,215,0,0.2);
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            background-color: transparent;
            border: 2px solid #ffd700;
        }
        
        .bronze-detail {
            background-image: url('https://i.postimg.cc/w3wd8bSR/image-2026-02-20-204059171.png');
        }
        
        .green-detail {
            background-image: url('https://files.catbox.moe/sat3sc.jpg');
        }
        
        .detail-name {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #ffd700;
        }
        
        .detail-price {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 22px;
            color: #ffd700;
            font-weight: bold;
        }
        
        .detail-price .star-icon {
            width: 28px;
            height: 28px;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .open-case-btn, .demo-case-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
        }
        
        .open-case-btn {
            background: linear-gradient(145deg, #4CAF50, #45a049);
            color: white;
        }
        
        .demo-case-btn {
            background: linear-gradient(145deg, #ff9800, #f57c00);
            color: white;
        }
        
        .open-case-btn:hover, .demo-case-btn:hover {
            transform: scale(1.02);
        }
        
        .total-price {
            font-size: 12px;
            background: rgba(255,255,255,0.2);
            padding: 2px 8px;
            border-radius: 12px;
        }
        
        .demo-badge {
            font-size: 10px;
            background: rgba(255,255,255,0.2);
            padding: 2px 6px;
            border-radius: 10px;
        }
        
        .quantity-section {
            background: #0f0f0f;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #2a2a2a;
        }
        
        .quantity-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .quantity-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .quantity-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #ffd700;
            background: transparent;
            color: white;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            max-width: 60px;
        }
        
        .quantity-btn.active {
            background: #ffd700;
            color: #000;
        }
        
        .quantity-btn:hover {
            transform: scale(1.05);
        }
        
        .chances-section {
            background: #0f0f0f;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #2a2a2a;
        }
        
        .chances-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #ffd700;
        }
        
        .chance-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            border-radius: 12px;
            background: #1a1a1a;
            margin-bottom: 10px;
            border: 1px solid #2a2a2a;
        }
        
        .chance-item img {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: contain;
            background: transparent;
        }
        
        .chance-info {
            flex: 1;
        }
        
        .chance-name {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 4px;
            color: #fff;
        }
        
        .chance-bar-container {
            width: 100%;
            height: 6px;
            background: #2a2a2a;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 2px;
        }
        
        .chance-bar {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #ffb347);
            border-radius: 3px;
        }
        
        .chance-percent {
            font-size: 12px;
            color: #aaa;
        }
        
        .chance-value {
            font-size: 16px;
            font-weight: bold;
            color: #ffd700;
            min-width: 60px;
            text-align: right;
        }
        
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        
        .inventory-item {
            background: #0f0f0f;
            border-radius: 12px;
            padding: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
            border: 1px solid #2a2a2a;
        }
        
        .inventory-item img {
            width: 60px;
            height: 60px;
            object-fit: contain;
            margin-bottom: 5px;
            border-radius: 8px;
            background: transparent;
        }
        
        .inventory-item-name {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 3px;
            color: #fff;
        }
        
        .inventory-item-price {
            color: #ffd700;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .item-count {
            background: #ffd700;
            color: #000;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 5px;
        }
        
        .demo-badge-item {
            position: absolute;
            top: 3px;
            right: 3px;
            background: #ff9800;
            color: white;
            padding: 2px 4px;
            border-radius: 6px;
            font-size: 8px;
            font-weight: bold;
        }
        
        .sell-one-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 5px;
            border-radius: 5px;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 5px;
            transition: transform 0.2s;
        }
        .sell-one-btn:hover {
            transform: scale(1.05);
        }
        
        .sell-all-btn {
            background: #ff4444;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: transform 0.2s;
        }
        .sell-all-btn:hover {
            transform: scale(1.02);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .roulette-container {
            background: #0f0f0f;
            border-radius: 30px;
            padding: 20px;
            max-width: 95%;
            width: 600px;
            text-align: center;
            max-height: 90vh;
            overflow-y: auto;
            border: 2px solid #ffd700;
        }
        
        .demo-mode {
            background: linear-gradient(145deg, #ff9800, #f57c00);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 10px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .multi-roulette {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }
        
        .single-roulette {
            background: linear-gradient(145deg, #1a1a1a, #222);
            border-radius: 10px;
            padding: 15px 0;
            position: relative;
            overflow: hidden;
            height: 100px;
            border: 2px solid #ffd700;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }
        
        .roulette-track {
            display: flex;
            gap: 10px;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translateY(-50%);
            will-change: transform;
        }
        
        .roulette-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(255,255,255,0.1);
            padding: 5px;
            border-radius: 8px;
            min-width: 70px;
        }
        .roulette-item img {
            width: 40px;
            height: 40px;
            object-fit: contain;
            border-radius: 5px;
            background: transparent;
        }
        .roulette-item span {
            color: white;
            font-size: 10px;
            font-weight: bold;
        }
        
        .roulette-indicator {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            width: 3px;
            background: linear-gradient(to bottom, #ff0000, #ff4444);
            transform: translateX(-50%);
            box-shadow: 0 0 10px #ff0000;
            z-index: 2;
        }
        
        .results-container {
            max-height: 250px;
            overflow-y: auto;
            margin: 15px 0;
            padding: 10px;
            background: #1a1a1a;
            border-radius: 15px;
        }
        
        .result-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px;
            border-radius: 10px;
            background: #1a1a1a;
            margin-bottom: 8px;
            border: 1px solid #2a2a2a;
            position: relative;
        }
        
        .result-item.demo {
            opacity: 0.7;
            border: 2px dashed #ff9800;
        }
        
        .result-item img {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: contain;
            background: transparent;
        }
        
        .result-item-info {
            flex: 1;
            text-align: left;
        }
        
        .result-item-name {
            font-weight: bold;
            margin-bottom: 2px;
            color: #fff;
        }
        
        .result-item-price {
            color: #ffd700;
            font-size: 14px;
        }
        
        .sell-result-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            margin-left: 10px;
            transition: transform 0.2s;
        }
        .sell-result-btn:hover {
            transform: scale(1.05);
        }
        
        .demo-label {
            font-size: 10px;
            background: #ff9800;
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            margin-left: 10px;
        }
        
        .result-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        .result-button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .result-button.sell {
            background: #4CAF50;
            color: white;
        }
        
        .result-button.again {
            background: #ffd700;
            color: #000;
        }
        
        .result-button.sell-all {
            background: #ff4444;
            color: white;
        }
        
        .result-button:hover {
            transform: scale(1.02);
        }
        
        .close-button {
            width: 100%;
            padding: 12px;
            background: none;
            border: 2px solid #666;
            border-radius: 12px;
            color: #666;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .close-button:hover {
            background: #666;
            color: white;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #0f0f0f;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(255,215,0,0.1);
            z-index: 99;
            border-top: 1px solid #2a2a2a;
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s;
            color: #666;
        }
        
        .nav-item.active {
            color: #ffd700;
            transform: translateY(-2px);
        }
        
        .nav-icon {
            font-size: 28px;
        }
        
        .nav-label {
            font-size: 12px;
            font-weight: 500;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .empty-section {
            text-align: center;
            padding: 50px 20px;
            font-size: 18px;
            color: #666;
        }
        
        .profile-stats {
            background: #0f0f0f;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #2a2a2a;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #2a2a2a;
        }
        
        .stat-item:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            font-size: 16px;
            color: #aaa;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #ffd700;
        }
        
        .deposit-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        .deposit-option {
            background: linear-gradient(145deg, #ffd700, #ffb347);
            color: #333;
            border: none;
            padding: 15px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .deposit-option:hover {
            transform: scale(1.05);
        }
        
        .admin-login {
            position: fixed;
            top: 70px;
            right: 10px;
            width: 40px;
            height: 40px;
            background: rgba(255,215,0,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            z-index: 1000;
            transition: all 0.3s;
            border: 1px solid #ffd700;
        }
        
        .admin-login:hover {
            background: rgba(255,215,0,0.4);
            transform: scale(1.1);
        }
        
        .admin-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            background: #0f0f0f;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(255,215,0,0.2);
            z-index: 2000;
            overflow: hidden;
            display: none;
            flex-direction: column;
            border: 2px solid #ffd700;
        }
        
        .admin-header {
            background: linear-gradient(145deg, #1a1a1a, #222);
            color: #ffd700;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-header h2 {
            margin: 0;
            font-size: 24px;
        }
        
        .close-admin {
            background: none;
            border: none;
            color: #ffd700;
            font-size: 24px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }
        
        .close-admin:hover {
            background: rgba(255,215,0,0.2);
        }
        
        .admin-tabs {
            display: flex;
            border-bottom: 2px solid #2a2a2a;
        }
        
        .admin-tab {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: #aaa;
        }
        
        .admin-tab.active {
            background: #ffd700;
            color: #000;
        }
        
        .admin-tab-content {
            display: none;
            padding: 20px;
            overflow-y: auto;
            max-height: calc(80vh - 120px);
        }
        
        .admin-tab-content.active {
            display: block;
        }
        
        .users-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #2a2a2a;
            gap: 10px;
        }
        
        .user-item:last-child {
            border-bottom: none;
        }
        
        .user-name {
            font-weight: bold;
            min-width: 120px;
            color: #fff;
        }
        
        .user-stats {
            color: #ffd700;
            font-size: 14px;
        }
        
        .user-date {
            font-size: 10px;
            color: #666;
            min-width: 80px;
        }
        
        .user-actions {
            display: flex;
            gap: 5px;
        }
        
        .edit-balance-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .form-group {
            margin: 15px 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #ffd700;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border: 2px solid #2a2a2a;
            border-radius: 8px;
            font-size: 14px;
            background: #1a1a1a;
            color: #fff;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #2a2a2a;
        }
        
        .stat-label {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
        }
        
        .top-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .top-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            border-bottom: 1px solid #2a2a2a;
            color: #fff;
        }
        
        .top-rank {
            font-weight: bold;
            color: #ffd700;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <div class="back-button" id="backButton" onclick="showMainMenu()">‚Üê –ù–∞–∑–∞–¥</div>
        <div></div>
        <div class="balance-container" onclick="showBalanceModal()">
            <div class="star-icon"></div>
            <span class="balance-amount" id="balanceDisplay">0</span>
        </div>
    </div>

    <div class="content">
        <div id="mainMenu" class="section active">
            <h2 class="section-title">üéÅ –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–µ–π—Å—ã</h2>
            <div class="cases-grid">
                <div class="case-card" onclick="showCaseDetail('bronze')">
                    <div class="case-image bronze-case"></div>
                    <div class="case-name">–ë—Ä–æ–Ω–∑–æ–≤—ã–π –∫–µ–π—Å</div>
                    <div class="case-price">
                        <div class="small-star"></div>
                        99 ‚≠ê
                    </div>
                </div>
                
                <div class="case-card" onclick="showCaseDetail('green')">
                    <div class="case-image green-case"></div>
                    <div class="case-name">Green Case</div>
                    <div class="case-price">
                        <div class="small-star"></div>
                        199 ‚≠ê
                    </div>
                </div>
                
                <div class="case-card" onclick="showCaseDetail('gold')">
                    <div class="case-image" style="background: linear-gradient(145deg, #ffd700, #b8860b); background-size: contain; background-position: center; background-repeat: no-repeat;"></div>
                    <div class="case-name">–ó–æ–ª–æ—Ç–æ–π –∫–µ–π—Å</div>
                    <div class="case-price">
                        <div class="small-star"></div>
                        –°–∫–æ—Ä–æ
                    </div>
                </div>
                
                <div class="case-card" onclick="showCaseDetail('diamond')">
                    <div class="case-image" style="background: linear-gradient(145deg, #b9f2ff, #00ffff); background-size: contain; background-position: center; background-repeat: no-repeat;"></div>
                    <div class="case-name">–ê–ª–º–∞–∑–Ω—ã–π –∫–µ–π—Å</div>
                    <div class="case-price">
                        <div class="small-star"></div>
                        –°–∫–æ—Ä–æ
                    </div>
                </div>
            </div>
        </div>

        <div id="caseDetail" class="case-detail">
            <div class="detail-header">
                <div class="detail-image" id="detailImage"></div>
                <div class="detail-name" id="detailName"></div>
                <div class="detail-price" id="detailPrice"></div>
            </div>

            <div class="action-buttons">
                <button class="open-case-btn" onclick="openCase(false)" id="openCaseBtn">
                    <span>üí∞ –û—Ç–∫—Ä—ã—Ç—å –∑–∞ –∑–≤—ë–∑–¥—ã</span>
                    <span class="total-price" id="totalPrice"></span>
                </button>
                <button class="demo-case-btn" onclick="openCase(true)" id="demoCaseBtn">
                    <span>üé≤ –î–µ–º–æ-–æ—Ç–∫—Ä—ã—Ç–∏–µ</span>
                    <span class="demo-badge">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                </button>
            </div>

            <div class="quantity-section">
                <div class="quantity-title">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫—Ä—ã—Ç–∏–π:</div>
                <div class="quantity-buttons">
                    <button class="quantity-btn active" onclick="selectQuantity(1)">1</button>
                    <button class="quantity-btn" onclick="selectQuantity(2)">2</button>
                    <button class="quantity-btn" onclick="selectQuantity(3)">3</button>
                    <button class="quantity-btn" onclick="selectQuantity(4)">4</button>
                    <button class="quantity-btn" onclick="selectQuantity(5)">5</button>
                </div>
            </div>

            <div class="chances-section">
                <div class="chances-title">üìä –®–∞–Ω—Å—ã –≤—ã–ø–∞–¥–µ–Ω–∏—è</div>
                <div id="chancesList"></div>
            </div>
        </div>

        <div id="gamesSection" class="section">
            <h2 class="section-title">üéÆ –ú–∏–Ω–∏-–∏–≥—Ä—ã</h2>
            <div class="empty-section">
                üöß –†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ<br>
                –°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –∏–≥—Ä—ã!
            </div>
        </div>

        <div id="profileSection" class="section">
            <h2 class="section-title">üë§ –ü—Ä–æ—Ñ–∏–ª—å</h2>
            <div class="profile-stats">
                <div class="stat-item">
                    <span class="stat-label">–û—Ç–∫—Ä—ã—Ç–æ –∫–µ–π—Å–æ–≤:</span>
                    <span class="stat-value" id="openedCases">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">–ë–∞–ª–∞–Ω—Å –∑–≤—ë–∑–¥:</span>
                    <span class="stat-value" id="profileBalance">0 ‚≠ê</span>
                </div>
            </div>
            
            <h3 style="margin: 20px 0 10px; color: #ffd700;">üì¶ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
            <div id="inventory" class="inventory-grid"></div>
            <button class="sell-all-btn" onclick="sellAllInventory()" id="sellAllBtn" style="display: none;">üí∞ –ü—Ä–æ–¥–∞—Ç—å –≤—Å—ë</button>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchToCases()">
            <span class="nav-icon">üéÅ</span>
            <span class="nav-label">–ö–µ–π—Å—ã</span>
        </div>
        <div class="nav-item" onclick="switchToGames()">
            <span class="nav-icon">üéÆ</span>
            <span class="nav-label">–ò–≥—Ä—ã</span>
        </div>
        <div class="nav-item" onclick="switchToProfile()">
            <span class="nav-icon">üë§</span>
            <span class="nav-label">–ü—Ä–æ—Ñ–∏–ª—å</span>
        </div>
    </div>

    <div id="rouletteModal" class="modal">
        <div class="roulette-container">
            <div id="rouletteMode" class="demo-mode" style="display: none;">üé≤ –î–ï–ú–û-–†–ï–ñ–ò–ú</div>
            <div class="roulette-title" id="rouletteTitle">üé∞ –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–æ–≤</div>
            <div class="roulette-subtitle" id="rouletteSubtitle"></div>
            <div id="multiRoulette" class="multi-roulette"></div>
            <div id="resultsList" class="results-container"></div>
            <div id="finalButtons" style="display: none;">
                <div class="result-buttons">
                    <button class="result-button sell-all" onclick="sellAllCurrentResults()">üí∞ –ü—Ä–æ–¥–∞—Ç—å –≤—Å—ë</button>
                    <button class="result-button again" onclick="openAgain()">üé≤ –û—Ç–∫—Ä—ã—Ç—å –µ—â—ë</button>
                </div>
                <button class="close-button" onclick="closeRoulette()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="balanceModal" class="modal">
        <div class="roulette-container" style="max-width: 400px;">
            <div class="roulette-title">üí∞ –ë–∞–ª–∞–Ω—Å</div>
            <div style="font-size: 48px; color: #ffd700; margin: 20px 0;" id="modalBalance">0 ‚≠ê</div>
            
            <div class="deposit-options">
                <button class="deposit-option" onclick="depositStars(50)">50 ‚≠ê</button>
                <button class="deposit-option" onclick="depositStars(100)">100 ‚≠ê</button>
                <button class="deposit-option" onclick="depositStars(500)">500 ‚≠ê</button>
                <button class="deposit-option" onclick="depositStars(1000)">1000 ‚≠ê</button>
            </div>
            
            <button class="close-button" onclick="closeBalanceModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <div id="adminPanel" class="admin-panel">
        <div class="admin-header">
            <h2>üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
            <button onclick="toggleAdminPanel()" class="close-admin">‚úñ</button>
        </div>
        
        <div class="admin-tabs">
            <button class="admin-tab active" onclick="switchAdminTab('users')">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
            <button class="admin-tab" onclick="switchAdminTab('cases')">–ö–µ–π—Å—ã</button>
            <button class="admin-tab" onclick="switchAdminTab('stats')">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        </div>
        
        <div id="adminUsers" class="admin-tab-content active">
            <h3>üë• –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
            <div class="users-list" id="usersList">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
        
        <div id="adminCases" class="admin-tab-content">
            <h3>üé≤ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ–π—Å–∞–º–∏</h3>
            
            <div class="case-editor">
                <h4>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–µ–π—Å</h4>
                <select id="caseSelector" onchange="loadCaseForEdit()">
                    <option value="bronze">–ë—Ä–æ–Ω–∑–æ–≤—ã–π –∫–µ–π—Å</option>
                    <option value="green">Green Case</option>
                </select>
                
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–µ–π—Å–∞:</label>
                    <input type="text" id="caseName" value="">
                </div>
                
                <div class="form-group">
                    <label>–¶–µ–Ω–∞ (–∑–≤—ë–∑–¥):</label>
                    <input type="number" id="casePrice" value="" min="1">
                </div>
                
                <div class="form-group">
                    <label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (URL):</label>
                    <input type="text" id="caseImage" value="">
                </div>
                
                <h4>–ü—Ä–µ–¥–º–µ—Ç—ã –≤ –∫–µ–π—Å–µ</h4>
                <div id="itemsList"></div>
                
                <button class="admin-btn" onclick="addNewItem()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç</button>
                <button class="admin-btn save" onclick="saveCaseChanges()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                <button class="admin-btn danger" onclick="resetCasesToDefault()">‚Ü∫ –°–±—Ä–æ—Å–∏—Ç—å</button>
            </div>
        </div>
        
        <div id="adminStats" class="admin-tab-content">
            <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                    <div class="stat-value" id="totalUsers">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–í—Å–µ–≥–æ –æ—Ç–∫—Ä—ã—Ç–æ –∫–µ–π—Å–æ–≤</div>
                    <div class="stat-value" id="totalOpenedCases">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–í—Å–µ–≥–æ –∑–≤—ë–∑–¥ –≤ —Å–∏—Å—Ç–µ–º–µ</div>
                    <div class="stat-value" id="totalStars">0</div>
                </div>
            </div>
            
            <h4>–¢–æ–ø-10 –∫–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä–æ–≤</h4>
            <div class="top-list" id="topUsers"></div>
        </div>
    </div>

    <div class="admin-login" id="adminLoginButton" onclick="promptAdminPassword()" title="–í—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞">
        üë§
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // ========== –ù–ê–°–¢–†–û–ô–ö–ò ==========
        const SERVER_URL = 'https://case-bot-server.onrender.com';
        const OWNER_ID = 7389462195;

        // ========== –°–û–°–¢–û–Ø–ù–ò–ï ==========
        let state = {
            balance: 0,
            openedCases: 0,
            inventory: [],
            currentCase: 'bronze',
            selectedQuantity: 1,
            currentOpenings: [],
            isSpinning: false,
            isDemo: false
        };

        // ========== –í–°–ï –ü–†–ï–î–ú–ï–¢–´ ==========
        const allItems = {
            calendar: {
                id: 'calendar',
                name: '–ö–∞–ª–µ–Ω–¥–∞—Ä—å',
                emoji: 'üìÖ',
                image: 'https://files.catbox.moe/7jo557.jpg',
                price: 500
            },
            rose: {
                id: 'rose',
                name: '–†–æ–∑–æ—á–∫–∞',
                emoji: 'üåπ',
                image: 'https://cdn140.picsart.com/241734929003212.png',
                price: 25
            },
            cake: {
                id: 'cake',
                name: '–¢–æ—Ä—Ç–∏–∫',
                emoji: 'üç∞',
                image: 'https://files.catbox.moe/vrguwt.jpg',
                price: 50
            },
            diamond: {
                id: 'diamond',
                name: '–ê–ª–º–∞–∑–∏–∫',
                emoji: 'üíé',
                image: 'https://files.catbox.moe/va4bo8.jpg',
                price: 100
            },
            cup: {
                id: 'cup',
                name: '–ö—É–±–æ–∫',
                emoji: 'üèÜ',
                image: 'https://files.catbox.moe/u3ij5p.jpg',
                price: 100
            },
            stars150: {
                id: 'stars150',
                name: '150 –∑–≤—ë–∑–¥',
                emoji: '‚≠ê',
                image: 'https://nztcdn.com/files/34b13b5a-7b5f-4d29-9c92-8fada5f27b2f.webp',
                price: 150
            },
            xmas: {
                id: 'xmas',
                name: 'Xmas Stocking',
                emoji: 'üß¶',
                image: 'https://files.catbox.moe/q1xy28.jpg',
                price: 495
            },
            ring: {
                id: 'ring',
                name: '–ö–æ–ª—å—Ü–æ',
                emoji: 'üíç',
                image: 'https://files.catbox.moe/vrguwt.jpg',
                price: 100
            },
            ramen: {
                id: 'ramen',
                name: 'Instant Ramen',
                emoji: 'üçú',
                image: 'https://files.catbox.moe/zrwkcj.jpg',
                price: 520
            },
            icecream: {
                id: 'icecream',
                name: 'Ice Cream',
                emoji: 'üç¶',
                image: 'https://files.catbox.moe/qvr3d4.jpg',
                price: 560
            },
            bunny: {
                id: 'bunny',
                name: 'Jelly Bunny',
                emoji: 'üê∞',
                image: 'https://files.catbox.moe/fpi273.jpg',
                price: 750
            },
            star: {
                id: 'star',
                name: 'Hanging Star',
                emoji: '‚≠ê',
                image: 'https://files.catbox.moe/24j1q7.jpg',
                price: 917
            },
            bell: {
                id: 'bell',
                name: 'Sleigh Bell',
                emoji: 'üîî',
                image: 'https://files.catbox.moe/hodsw0.jpg',
                price: 1095
            },
            skull: {
                id: 'skull',
                name: 'Skull Flower',
                emoji: 'üíÄ',
                image: 'https://files.catbox.moe/j0a4bh.jpg',
                price: 1245
            },
            hat: {
                id: 'hat',
                name: 'Top Hat',
                emoji: 'üé©',
                image: 'https://files.catbox.moe/gpz9i3.jpg',
                price: 1293
            },
            skelettos: {
                id: 'skelettos',
                name: 'Sky Skelettos',
                emoji: 'üíÄ',
                image: 'https://files.catbox.moe/ntlowe.jpg',
                price: 1530
            },
            charm: {
                id: 'charm',
                name: 'Cupid Charm',
                emoji: '‚ù§Ô∏è',
                image: 'https://files.catbox.moe/civ0mf.jpg',
                price: 2038
            },
            ringExpensive: {
                id: 'ringExpensive',
                name: 'Diamond Ring',
                emoji: 'üíç',
                image: 'https://files.catbox.moe/k7fvb8.jpg',
                price: 2858
            },
            cigar: {
                id: 'cigar',
                name: 'Vintage Cigar',
                emoji: 'üö¨',
                image: 'https://files.catbox.moe/9n955x.jpg',
                price: 3357
            }
        };

        // ========== –ö–ï–ô–°–´ ==========
        let cases = {
            bronze: {
                name: '–ë—Ä–æ–Ω–∑–æ–≤—ã–π –∫–µ–π—Å',
                price: 99,
                image: 'bronze',
                color: 'linear-gradient(145deg, #cd7f32, #b87333)',
                items: [
                    { ...allItems.calendar, chance: 10 },
                    { ...allItems.rose, chance: 90 }
                ]
            },
            green: {
                name: 'Green Case',
                price: 199,
                image: 'green',
                color: 'linear-gradient(145deg, #00ff00, #00aa00)',
                items: [
                    { ...allItems.cake, chance: 27 },
                    { ...allItems.diamond, chance: 26 },
                    { ...allItems.cup, chance: 13 },
                    { ...allItems.stars150, chance: 10 },
                    { ...allItems.ring, chance: 10 },
                    { ...allItems.xmas, chance: 5 },
                    { ...allItems.ramen, chance: 2.5 },
                    { ...allItems.icecream, chance: 2 },
                    { ...allItems.bunny, chance: 1.5 },
                    { ...allItems.star, chance: 0.64 },
                    { ...allItems.bell, chance: 0.52 },
                    { ...allItems.skull, chance: 0.5 },
                    { ...allItems.hat, chance: 0.4 },
                    { ...allItems.skelettos, chance: 0.35 },
                    { ...allItems.charm, chance: 0.25 },
                    { ...allItems.ringExpensive, chance: 0.21 },
                    { ...allItems.cigar, chance: 0.13 }
                ]
            },
            gold: {
                name: '–ó–æ–ª–æ—Ç–æ–π –∫–µ–π—Å',
                price: 0,
                image: 'gold',
                color: 'linear-gradient(145deg, #ffd700, #b8860b)',
                items: []
            },
            diamond: {
                name: '–ê–ª–º–∞–∑–Ω—ã–π –∫–µ–π—Å',
                price: 0,
                image: 'diamond',
                color: 'linear-gradient(145deg, #b9f2ff, #00ffff)',
                items: []
            }
        };

        // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        function getUserId() {
            return tg.initDataUnsafe?.user?.id || null;
        }

        function getUserName() {
            const user = tg.initDataUnsafe?.user;
            if (!user) return 'User';
            return user.username || user.first_name || `User_${user.id}`;
        }

        function isOwner() {
            const userId = getUserId();
            return userId && userId == OWNER_ID;
        }

        function updateAdminButtonVisibility() {
            const btn = document.getElementById('adminLoginButton');
            if (btn) btn.style.display = isOwner() ? 'flex' : 'none';
        }

        // ========== –†–ê–ë–û–¢–ê –° –°–ï–†–í–ï–†–û–ú ==========
        async function loadUser() {
            const userId = getUserId();
            if (!userId) return;

            try {
                const res = await fetch(`${SERVER_URL}/api/user`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: Number(userId),
                        username: getUserName(),
                        firstName: tg.initDataUnsafe?.user?.first_name || ''
                    })
                });
                
                if (res.ok) {
                    const data = await res.json();
                    state.balance = data.balance || 0;
                    state.openedCases = data.openedCases || 0;
                    state.inventory = data.inventory || [];
                    updateBalance();
                    renderInventory();
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', e);
            }
        }

        async function saveUser() {
            const userId = getUserId();
            if (!userId) return;

            try {
                await fetch(`${SERVER_URL}/api/user/save`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: Number(userId),
                        balance: state.balance,
                        openedCases: state.openedCases,
                        inventory: state.inventory
                    })
                });
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', e);
            }
        }

        async function loadUsers() {
            try {
                const res = await fetch(`${SERVER_URL}/api/users`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ adminId: Number(OWNER_ID) })
                });
                
                if (res.ok) return await res.json();
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', e);
            }
            return [];
        }

        async function loadStats() {
            try {
                const res = await fetch(`${SERVER_URL}/api/stats`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ adminId: Number(OWNER_ID) })
                });
                
                if (res.ok) return await res.json();
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', e);
            }
            return null;
        }

        async function updateBalanceOnServer(userId, newBalance) {
            try {
                const res = await fetch(`${SERVER_URL}/api/user/balance`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: Number(userId),
                        newBalance: Number(newBalance),
                        adminId: Number(OWNER_ID)
                    })
                });
                return res.ok;
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞:', e);
                return false;
            }
        }

        // ========== –§–£–ù–ö–¶–ò–ò –ò–ù–¢–ï–†–§–ï–ô–°–ê ==========
        function updateBalance() {
            document.getElementById('balanceDisplay').textContent = state.balance;
            document.getElementById('profileBalance').textContent = state.balance + ' ‚≠ê';
            saveUser();
        }

        function renderInventory() {
            const div = document.getElementById('inventory');
            const sellAllBtn = document.getElementById('sellAllBtn');
            
            if (!state.inventory.length) {
                div.innerHTML = '<div class="empty-section">ü´ô –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</div>';
                sellAllBtn.style.display = 'none';
                return;
            } else {
                sellAllBtn.style.display = 'block';
            }

            const grouped = {};
            state.inventory.forEach(item => {
                const key = `${item.id}_${item.isDemo ? 'demo' : 'real'}`;
                if (!grouped[key]) {
                    grouped[key] = {
                        ...item,
                        items: [item]
                    };
                } else {
                    grouped[key].items.push(item);
                }
            });

            let html = '';
            for (let key in grouped) {
                const group = grouped[key];
                const item = group.items[0];
                const count = group.items.length;
                
                html += `
                    <div class="inventory-item">
                        ${item.isDemo ? '<div class="demo-badge-item">DEMO</div>' : ''}
                        <img src="${item.image}">
                        <div class="inventory-item-name">${item.emoji} ${item.name}</div>
                        <div class="inventory-item-price">${item.price} ‚≠ê</div>
                        <span class="item-count">x${count}</span>
                        ${!item.isDemo ? `<button class="sell-one-btn" onclick="sellItem('${item.id}')">–ü—Ä–æ–¥–∞—Ç—å 1</button>` : ''}
                    </div>
                `;
            }
            div.innerHTML = html;
        }

        function sellItem(itemId) {
            const idx = state.inventory.findIndex(i => i.id === itemId && !i.isDemo);
            if (idx === -1) return;
            const item = state.inventory[idx];
            state.balance += item.price;
            state.inventory.splice(idx, 1);
            updateBalance();
            renderInventory();
        }

        function sellAllInventory() {
            const total = state.inventory.reduce((sum, item) => sum + (item.isDemo ? 0 : item.price), 0);
            if (total === 0) {
                alert('–ù–µ—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏');
                return;
            }
            state.balance += total;
            state.inventory = state.inventory.filter(item => item.isDemo);
            updateBalance();
            renderInventory();
            tg.showPopup({
                title: '–ü—Ä–æ–¥–∞–Ω–æ!',
                message: `–í—ã –ø—Ä–æ–¥–∞–ª–∏ –≤—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∑–∞ ${total} ‚≠ê`,
                buttons: [{type: 'ok'}]
            });
        }

        // ========== –ù–ê–í–ò–ì–ê–¶–ò–Ø ==========
        function switchToCases() {
            document.querySelectorAll('.nav-item').forEach((item, i) => item.classList.toggle('active', i === 0));
            document.getElementById('mainMenu').classList.add('active');
            document.getElementById('gamesSection').classList.remove('active');
            document.getElementById('profileSection').classList.remove('active');
            document.getElementById('caseDetail').classList.remove('active');
            document.getElementById('backButton').classList.remove('visible');
        }

        function switchToGames() {
            document.querySelectorAll('.nav-item').forEach((item, i) => item.classList.toggle('active', i === 1));
            document.getElementById('mainMenu').classList.remove('active');
            document.getElementById('caseDetail').classList.remove('active');
            document.getElementById('gamesSection').classList.add('active');
            document.getElementById('profileSection').classList.remove('active');
            document.getElementById('backButton').classList.remove('visible');
        }

        function switchToProfile() {
            document.querySelectorAll('.nav-item').forEach((item, i) => item.classList.toggle('active', i === 2));
            document.getElementById('mainMenu').classList.remove('active');
            document.getElementById('caseDetail').classList.remove('active');
            document.getElementById('gamesSection').classList.remove('active');
            document.getElementById('profileSection').classList.add('active');
            document.getElementById('backButton').classList.remove('visible');
            renderInventory();
        }

        function showMainMenu() {
            document.getElementById('caseDetail').classList.remove('active');
            document.getElementById('mainMenu').classList.add('active');
            document.getElementById('backButton').classList.remove('visible');
        }

        function showCaseDetail(caseId) {
            state.currentCase = caseId;
            const caseData = cases[caseId];
            
            document.getElementById('mainMenu').classList.remove('active');
            document.getElementById('caseDetail').classList.add('active');
            document.getElementById('backButton').classList.add('visible');
            
            const detailImage = document.getElementById('detailImage');
            if (caseId === 'bronze') {
                detailImage.className = 'detail-image bronze-detail';
            } else if (caseId === 'green') {
                detailImage.className = 'detail-image green-detail';
            } else {
                detailImage.className = 'detail-image';
                detailImage.style.background = caseData.color;
                detailImage.innerHTML = caseData.image === 'gold' ? 'ü•á' : 'üíé';
            }
            
            document.getElementById('detailName').textContent = caseData.name;
            document.getElementById('detailPrice').innerHTML = `<div class="star-icon"></div>${caseData.price} –∑–≤—ë–∑–¥`;
            
            const chancesList = document.getElementById('chancesList');
            chancesList.innerHTML = '';
            
            caseData.items.forEach(item => {
                chancesList.innerHTML += `
                    <div class="chance-item">
                        <img src="${item.image}">
                        <div class="chance-info">
                            <div class="chance-name">${item.emoji} ${item.name}</div>
                            <div class="chance-bar-container">
                                <div class="chance-bar" style="width:${item.chance}%"></div>
                            </div>
                            <div class="chance-percent">${item.chance}%</div>
                        </div>
                        <div class="chance-value">${item.price} ‚≠ê</div>
                    </div>
                `;
            });
            
            selectQuantity(1);
        }

        function selectQuantity(q) {
            state.selectedQuantity = q;
            document.querySelectorAll('.quantity-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`.quantity-btn:nth-child(${q})`).classList.add('active');
            const caseData = cases[state.currentCase];
            document.getElementById('totalPrice').innerHTML = `${caseData.price * q} ‚≠ê`;
        }

        function showBalanceModal() {
            document.getElementById('modalBalance').textContent = state.balance + ' ‚≠ê';
            document.getElementById('balanceModal').classList.add('active');
        }

        function closeBalanceModal() {
            document.getElementById('balanceModal').classList.remove('active');
        }

        function depositStars(amount) {
            state.balance += amount;
            updateBalance();
            closeBalanceModal();
        }

        async function openCase(isDemo) {
            if (state.isSpinning) return;
            
            const caseData = cases[state.currentCase];
            const total = caseData.price * state.selectedQuantity;
            
            if (!isDemo && state.balance < total) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥');
                return;
            }
            
            state.isSpinning = true;
            state.isDemo = isDemo;
            
            if (!isDemo) {
                state.balance -= total;
                updateBalance();
            }
            
            const results = [];
            for (let i = 0; i < state.selectedQuantity; i++) {
                let r = Math.random() * 100;
                let s = 0;
                let item = caseData.items[0];
                for (const it of caseData.items) {
                    s += it.chance;
                    if (r <= s) {
                        item = it;
                        break;
                    }
                }
                results.push({ ...item, timestamp: Date.now() + i, isDemo });
            }
            
            state.currentOpenings = results;
            
            const modal = document.getElementById('rouletteModal');
            const multi = document.getElementById('multiRoulette');
            const rlist = document.getElementById('resultsList');
            const fbtn = document.getElementById('finalButtons');
            const rmode = document.getElementById('rouletteMode');
            
            modal.classList.add('active');
            multi.innerHTML = '';
            rlist.innerHTML = '';
            
            if (isDemo) {
                rmode.style.display = 'inline-block';
            } else {
                rmode.style.display = 'none';
            }
            fbtn.style.display = 'none';
            
            const iw = 80;
            const gap = 10;
            const tiw = iw + gap;
            
            for (let i = 0; i < state.selectedQuantity; i++) {
                const rd = document.createElement('div');
                rd.className = 'single-roulette';
                rd.id = `r-${i}`;
                const tr = document.createElement('div');
                tr.className = 'roulette-track';
                
                for (let j = 0; j < 70; j++) {
                    let it;
                    if (j >= 35 && j < 36) {
                        it = results[i];
                    } else {
                        let rand = Math.random() * 100;
                        let cum = 0;
                        it = caseData.items[0];
                        for (const item of caseData.items) {
                            cum += item.chance;
                            if (rand <= cum) {
                                it = item;
                                break;
                            }
                        }
                    }
                    const el = document.createElement('div');
                    el.className = 'roulette-item';
                    el.style.minWidth = iw + 'px';
                    el.innerHTML = `<img src="${it.image}"><span>${it.name}</span>`;
                    tr.appendChild(el);
                }
                rd.appendChild(tr);
                rd.innerHTML += '<div class="roulette-indicator"></div>';
                multi.appendChild(rd);
                tr.style.transform = `translateY(-50%) translateX(${-tiw * 20}px)`;
            }
            
            await new Promise(r => setTimeout(r, 100));
            
            for (let i = 0; i < state.selectedQuantity; i++) {
                const tr = document.querySelector(`#r-${i} .roulette-track`);
                const target = -(35 * tiw + iw/2);
                tr.style.transition = `transform 5000ms cubic-bezier(0.15, 0.85, 0.35, 1)`;
                tr.style.transform = `translateY(-50%) translateX(${target}px)`;
            }
            
            await new Promise(r => setTimeout(r, 5200));
            
            results.forEach(r => {
                rlist.innerHTML += `
                    <div class="result-item ${isDemo ? 'demo' : ''}">
                        <img src="${r.image}">
                        <div class="result-item-info">
                            <div class="result-item-name">${r.emoji} ${r.name}</div>
                            <div class="result-item-price">${r.price} ‚≠ê</div>
                        </div>
                        ${!isDemo ? `<button class="sell-result-btn" onclick="sellSingleResult('${r.timestamp}')">–ü—Ä–æ–¥–∞—Ç—å</button>` : ''}
                        ${isDemo ? '<span class="demo-label">DEMO</span>' : ''}
                    </div>
                `;
            });
            
            if (!isDemo) {
                state.inventory.push(...results);
                state.openedCases += state.selectedQuantity;
                document.getElementById('openedCases').textContent = state.openedCases;
                saveUser();
            }
            
            fbtn.style.display = 'block';
            state.isSpinning = false;
            
            document.body.style.overflow = 'auto';
        }

        function sellSingleResult(timestamp) {
            const itemIndex = state.currentOpenings.findIndex(i => i.timestamp == timestamp);
            if (itemIndex === -1) return;
            
            const item = state.currentOpenings[itemIndex];
            state.balance += item.price;
            
            const invIndex = state.inventory.findIndex(i => i.timestamp == timestamp);
            if (invIndex !== -1) {
                state.inventory.splice(invIndex, 1);
            }
            
            state.currentOpenings.splice(itemIndex, 1);
            
            updateBalance();
            renderInventory();
            
            const rlist = document.getElementById('resultsList');
            if (state.currentOpenings.length === 0) {
                rlist.innerHTML = '<div class="empty-section">–í—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã –ø—Ä–æ–¥–∞–Ω—ã</div>';
            } else {
                let html = '';
                state.currentOpenings.forEach(r => {
                    html += `
                        <div class="result-item ${r.isDemo ? 'demo' : ''}">
                            <img src="${r.image}">
                            <div class="result-item-info">
                                <div class="result-item-name">${r.emoji} ${r.name}</div>
                                <div class="result-item-price">${r.price} ‚≠ê</div>
                            </div>
                            ${!r.isDemo ? `<button class="sell-result-btn" onclick="sellSingleResult('${r.timestamp}')">–ü—Ä–æ–¥–∞—Ç—å</button>` : ''}
                            ${r.isDemo ? '<span class="demo-label">DEMO</span>' : ''}
                        </div>
                    `;
                });
                rlist.innerHTML = html;
            }
            
            tg.showPopup({
                title: '–ü—Ä–æ–¥–∞–Ω–æ!',
                message: `–í—ã –ø—Ä–æ–¥–∞–ª–∏ ${item.name} –∑–∞ ${item.price} ‚≠ê`,
                buttons: [{type: 'ok'}]
            });
        }

        function sellAllCurrentResults() {
            if (state.isDemo) { 
                closeRoulette(); 
                return; 
            }
            const total = state.currentOpenings.reduce((s,i) => s + i.price, 0);
            state.balance += total;
            
            state.currentOpenings.forEach(w => {
                const idx = state.inventory.findIndex(i => i.timestamp === w.timestamp);
                if (idx !== -1) state.inventory.splice(idx, 1);
            });
            
            state.currentOpenings = [];
            updateBalance();
            closeRoulette();
            
            tg.showPopup({
                title: '–ü—Ä–æ–¥–∞–Ω–æ!',
                message: `–í—ã –ø—Ä–æ–¥–∞–ª–∏ –≤—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∑–∞ ${total} ‚≠ê`,
                buttons: [{type: 'ok'}]
            });
        }

        function openAgain() {
            closeRoulette();
            setTimeout(() => openCase(state.isDemo), 300);
        }

        function closeRoulette() {
            document.getElementById('rouletteModal').classList.remove('active');
        }

        const ADMIN_PASSWORD = 'admin123';
        
        function promptAdminPassword() {
            if (!isOwner()) { alert('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞'); return; }
            if (prompt('–ü–∞—Ä–æ–ª—å:') === ADMIN_PASSWORD) {
                document.getElementById('adminPanel').style.display = 'flex';
                loadAdminData();
            }
        }

        function toggleAdminPanel() {
            const p = document.getElementById('adminPanel');
            p.style.display = p.style.display === 'none' ? 'flex' : 'none';
        }

        function switchAdminTab(tab) {
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.admin-tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(`admin${tab.charAt(0).toUpperCase() + tab.slice(1)}`).classList.add('active');
            if (tab === 'users') loadUsersList();
            if (tab === 'stats') loadStatsData();
        }

        async function loadAdminData() {
            await loadUsersList();
            await loadStatsData();
            loadCaseForEdit();
        }

        async function loadUsersList() {
            const users = await loadUsers();
            const list = document.getElementById('usersList');
            if (!users || users.length === 0) {
                list.innerHTML = '<div class="empty-section">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>';
                return;
            }

            let html = '';
            users.sort((a,b) => new Date(b.lastSeen) - new Date(a.lastSeen));
            users.forEach(u => {
                html += `
                    <div class="user-item">
                        <span class="user-name">${u.username || 'User'}</span>
                        <span class="user-stats">üí∞ ${u.balance || 0} ‚≠ê | üé≤ ${u.openedCases || 0}</span>
                        <span class="user-date">${u.lastSeen ? new Date(u.lastSeen).toLocaleDateString() : ''}</span>
                        <div class="user-actions">
                            <button class="edit-balance-btn" onclick="editUserBalance('${u.userId}')">‚úèÔ∏è</button>
                        </div>
                    </div>
                `;
            });
            list.innerHTML = html;
        }

        async function editUserBalance(userId) {
            const newBal = prompt('–ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å:');
            if (!newBal || isNaN(parseInt(newBal))) return;
            const amount = parseInt(newBal);
            const ok = await updateBalanceOnServer(userId, amount);
            if (ok) {
                if (userId == getUserId()) {
                    state.balance = amount;
                    updateBalance();
                }
                await loadUsersList();
                await loadStatsData();
            }
        }

        async function loadStatsData() {
            const stats = await loadStats();
            if (!stats) return;
            document.getElementById('totalUsers').textContent = stats.totalUsers || 0;
            document.getElementById('totalOpenedCases').textContent = stats.totalOpenedCases || 0;
            document.getElementById('totalStars').textContent = stats.totalStars || 0;
            
            const topList = document.getElementById('topUsers');
            let html = '';
            (stats.topUsers || []).forEach((u, i) => {
                html += `<div class="top-item"><span class="top-rank">${i+1}.</span> ${u.username || 'User'} <span>${u.openedCases || 0} –∫–µ–π—Å–æ–≤</span></div>`;
            });
            topList.innerHTML = html || '<div class="empty-section">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>';
        }

        function loadCaseForEdit() {
            const caseId = document.getElementById('caseSelector').value;
            const caseData = cases[caseId];
            
            document.getElementById('caseName').value = caseData.name;
            document.getElementById('casePrice').value = caseData.price;
            
            const list = document.getElementById('itemsList');
            list.innerHTML = '';
            caseData.items.forEach((item, idx) => {
                list.innerHTML += `
                    <div class="item-edit" id="item-${idx}">
                        <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label><input type="text" class="item-name" value="${item.name}"></div>
                        <div class="form-group"><label>–≠–º–æ–¥–∑–∏:</label><input type="text" class="item-emoji" value="${item.emoji}"></div>
                        <div class="form-group"><label>URL:</label><input type="text" class="item-image" value="${item.image}"></div>
                        <div class="form-group"><label>–¶–µ–Ω–∞:</label><input type="number" class="item-price" value="${item.price}"></div>
                        <div class="form-group"><label>–®–∞–Ω—Å:</label><input type="number" class="item-chance" value="${item.chance}" min="0.01" max="100" step="0.01"></div>
                        <button class="admin-btn danger" onclick="removeItem(${idx})">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                `;
            });
        }

        function addNewItem() { alert('–§—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ'); }
        function removeItem(idx) { if (confirm('–£–¥–∞–ª–∏—Ç—å?')) document.getElementById(`item-${idx}`).remove(); }
        function saveCaseChanges() { alert('–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã'); }
        function resetCasesToDefault() { if (confirm('–°–±—Ä–æ—Å–∏—Ç—å?')) location.reload(); }

        // ========== –°–¢–ê–†–¢ ==========
        updateAdminButtonVisibility();
        loadUser();
    </script>
</body>
</html>